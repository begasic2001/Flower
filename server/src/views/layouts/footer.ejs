<div class="brands">
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="brands_slider_container">

                    <!-- Brands Slider -->

                    <div class="owl-carousel owl-theme brands_slider">

                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_1.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_2.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_3.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_4.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_5.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_6.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_7.jpg" alt=""></div>
                        </div>
                        <div class="owl-item">
                            <div class="brands_item d-flex flex-column justify-content-center"><img
                                    src="images/brands_8.jpg" alt=""></div>
                        </div>

                    </div>

                    <!-- Brands Slider Navigation -->
                    <div class="brands_nav brands_prev"><i class="fas fa-chevron-left"></i></div>
                    <div class="brands_nav brands_next"><i class="fas fa-chevron-right"></i></div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Newsletter -->

<div class="newsletter">
    <div class="container">
        <div class="row">
            <div class="col">
                <div
                    class="newsletter_container d-flex flex-lg-row flex-column align-items-lg-center align-items-center justify-content-lg-start justify-content-center">
                    <div class="newsletter_title_container">
                        <div class="newsletter_icon"><img src="images/send.png" alt=""></div>
                        <div class="newsletter_title">Sign up for Newsletter</div>
                        <div class="newsletter_text">
                            <p>...and receive %20 coupon for first shopping.</p>
                        </div>
                    </div>
                    <div class="newsletter_content clearfix">
                        <form action="#" class="newsletter_form">
                            <input type="email" class="newsletter_input" required="required"
                                placeholder="Enter your email address">
                            <button class="newsletter_button">Subscribe</button>
                        </form>
                        <div class="newsletter_unsubscribe_link"><a href="#">unsubscribe</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="row">

            <div class="col-lg-3 footer_col">
                <div class="footer_column footer_contact">
                    <div class="logo_container">
                        <div class="logo"><a href="#">OneTech</a></div>
                    </div>
                    <div class="footer_title">Got Question? Call Us 24/7</div>
                    <div class="footer_phone">+38 068 005 3570</div>
                    <div class="footer_contact_text">
                        <p>17 Princess Road, London</p>
                        <p>Grester London NW18JR, UK</p>
                    </div>
                    <div class="footer_social">
                        <ul>
                            <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#"><i class="fab fa-youtube"></i></a></li>
                            <li><a href="#"><i class="fab fa-google"></i></a></li>
                            <li><a href="#"><i class="fab fa-vimeo-v"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-lg-2 offset-lg-2">
                <div class="footer_column">
                    <div class="footer_title">Find it Fast</div>
                    <ul class="footer_list">
                        <li><a href="#">Computers & Laptops</a></li>
                        <li><a href="#">Cameras & Photos</a></li>
                        <li><a href="#">Hardware</a></li>
                        <li><a href="#">Smartphones & Tablets</a></li>
                        <li><a href="#">TV & Audio</a></li>
                    </ul>
                    <div class="footer_subtitle">Gadgets</div>
                    <ul class="footer_list">
                        <li><a href="#">Car Electronics</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-2">
                <div class="footer_column">
                    <ul class="footer_list footer_list_2">
                        <li><a href="#">Video Games & Consoles</a></li>
                        <li><a href="#">Accessories</a></li>
                        <li><a href="#">Cameras & Photos</a></li>
                        <li><a href="#">Hardware</a></li>
                        <li><a href="#">Computers & Laptops</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-2">
                <div class="footer_column">
                    <div class="footer_title">Customer Care</div>
                    <ul class="footer_list">
                        <li><a href="#">My Account</a></li>
                        <li><a href="#">Order Tracking</a></li>
                        <li><a href="#">Wish List</a></li>
                        <li><a href="#">Customer Services</a></li>
                        <li><a href="#">Returns / Exchange</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Product Support</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</footer>

<!-- Copyright -->

<div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col">

                <div
                    class="copyright_container d-flex flex-sm-row flex-column align-items-center justify-content-start">
                    <div class="copyright_content">
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        Copyright &copy;
                        <script>document.write(new Date().getFullYear());</script> All rights reserved | This template
                        is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com"
                            target="_blank">Colorlib</a>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </div>
                    <div class="logos ml-sm-auto">
                        <ul class="logos_list">
                            <li><a href="#"><img src="images/logos_1.png" alt=""></a></li>
                            <li><a href="#"><img src="images/logos_2.png" alt=""></a></li>
                            <li><a href="#"><img src="images/logos_3.png" alt=""></a></li>
                            <li><a href="#"><img src="images/logos_4.png" alt=""></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script src="/client/js/jquery-3.3.1.min.js"></script>
<script src="/client/styles/bootstrap4/popper.js"></script>
<script src="/client/styles/bootstrap4/bootstrap.min.js"></script>
<script src="/client/plugins/greensock/TweenMax.min.js"></script>
<script src="/client/plugins/greensock/TimelineMax.min.js"></script>
<script src="/client/plugins/scrollmagic/ScrollMagic.min.js"></script>
<script src="/client/plugins/greensock/animation.gsap.min.js"></script>
<script src="/client/plugins/greensock/ScrollToPlugin.min.js"></script>
<script src="/client/plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
<script src="/client/plugins/slick-1.8.0/slick.js"></script>
<script src="/client/plugins/easing/easing.js"></script>
<script src="/client/js/custom.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.0/axios.min.js"></script>
<script>
    $(document).on('click','.product_fav',function(e){
        e.preventDefault()
        const accessToken = window.localStorage.getItem('accessToken')
        const id = $('input[name = "productId"]').val()
        $.ajax({
            url: `http://localhost:9000/api/wishlist/addToWishList/${id}`,
            type: "POST",
            headers:{ 'Authorization': `Bearer ${accessToken}` }
        }).then(data => {
            if(!window.localStorage.getItem('accessToken')){
                swal(`Bạn cần đăng nhập`).then(()=>{
                     window.location.reload();
                })
            }
            swal(`Lưu thành công`).then(() => {
                window.location.reload();
            })
        })
    })
</script>
    <script>
        const instance = axios.create({
            baseURL: 'http://localhost:9000',
            timeout: 3 * 1000,
            headers: {
                'Content-Type': 'Application/json'
            }
        });

        instance.interceptors.request.use(async function (config) {
            if (config.url.indexOf('/api/auth/login') >= 0 || config.url.indexOf('/api/auth/refresh-token') >= 0) {
                return config
            }
            const token = await instance.getLocalAccessToken()
            config.headers['authorization'] = `Bearer ${token}`
            return config
        }, function (error) {
            // Do something with request error
            return Promise.reject(error);
        });

        instance.interceptors.response.use(async function (response) {
            const config = response.config
            if (config.url.indexOf('/api/auth/login') >= 0 || config.url.indexOf('/api/auth/refresh-token') >= 0) {
                return response
            }
            const { status, message } = response.data
            if (status && status === 401) {
                //B1 get accessToken from refreshToken
                const token = await instance.getLocalRefreshToken()

                const newRefresh = await refreshToken(token)
                if (newRefresh) {
                    console.log(`Đã lấy lại token thành công :::::::::`)
                    //B2 Đã lấy lại token
                    config.headers['authorization'] = `Bearer ${newRefresh.accessToken}`
                    // // B3
                    await instance.setLocalAccessToken(newRefresh.accessToken)
                    await instance.setLocalRefreshToken(newRefresh.refreshToken)
                    return instance(config)
                }
            }

            return response
        }, function (error) {
            return Promise.reject(error);
        });

        const btnLogin = document.querySelector('button');
        if (btnLogin) {
            btnLogin.addEventListener('click', async (e) => {
                e.preventDefault()
                const { status, accessToken, refreshToken, user } = await login()
                if (status == 'success') {
                    await instance.setLocalAccessToken(accessToken)
                    await instance.setLocalRefreshToken(refreshToken)
                    await instance.setLocalInfoUser(user)
                    window.location.replace("/")
                }
            })
        }
        async function login() {
            const email = $('input[name="email"]').val()
            const password = $('input[name="password"]').val()

            return await instance.post('/api/auth/login', {
                email: email,
                password: password,
            }).then((result) => {
                return result.data
            });
        }
        async function refreshToken(refreshToken) {
            return await instance.post('/api/auth/refresh-token', {
                refreshToken: refreshToken
            }).then((result) => {
                return result.data
            });
        }
        instance.setLocalAccessToken = async (token) => {
            window.localStorage.setItem('accessToken', token)
        }

        instance.setLocalRefreshToken = async (token) => {
            window.localStorage.setItem('refreshToken', token)
        }

        instance.setLocalInfoUser = async (user) => {
            window.localStorage.setItem('user', JSON.stringify(user))
        }

        instance.getLocalAccessToken = async () => {
            return window.localStorage.getItem('accessToken') ? window.localStorage.getItem('accessToken') : null

        }
        instance.getLocalRefreshToken = async () => {
            return window.localStorage.getItem('refreshToken') ? window.localStorage.getItem('refreshToken') : null

        }
        instance.getLocalInfoUser = () => {
            return JSON.parse(window.localStorage.getItem('user')) ? JSON.parse(window.localStorage.getItem('user')) : null
        }
        
        // hiển thị tên ng dùng sau khi đăng nhập
       
                let user = instance.getLocalInfoUser()
                console.log(user)
                let html = ''
                if (user !== null) {
                    $('.top_bar_user').append(`<div class='user-${user.id}'>${user.name}</div>
                                                 <div><a href="/logout">Đăng Xuất</a></div>`)
                } else {
                    $('.top_bar_user').append(`<div class="user_icon"><img src="/client/images/user.svg" alt=""></div>
                                                <div><a href="/login">Đăng nhập</a></div>
                                                <div><a href="/register">Đăng ký</a></div>`)
                }
          
    </script>
<script>
   
</script>

</body>

</html>